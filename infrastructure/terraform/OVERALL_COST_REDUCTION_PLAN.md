# ğŸš€ å…¨ä½“ã‚¤ãƒ³ãƒ•ãƒ©ã‚³ã‚¹ãƒˆå‰Šæ¸›è¨ˆç”»
## æœ¬ç•ªç’°å¢ƒ + STGç’°å¢ƒ çµ±åˆæœ€é©åŒ–

### ğŸ“Š ç¾åœ¨ã®ã‚³ã‚¹ãƒˆæ§‹é€  (åˆè¨ˆ $497/æœˆ)
| é …ç›® | æœˆé¡ | å†…è¨³ |
|------|------|------|
| **VPC** | **$214.97** | VPC Endpoints (PROD:$90 + STG:$90) + ãã®ä»– |
| **EC2-Other** | **$87.85** | NAT Gateway (PROD:$45 + STG:$45) |
| **ECS** | **$67.76** | Fargate (PROD:$35 + STG:$35) |
| **ALB** | **$54.05** | ALB x4å° (PROD:2å° + STG:2å°) |
| **Others** | **$27.34** | RDSã€S3ã€ãã®ä»– |
| **Tax** | **$45.20** | æ¶ˆè²»ç¨ |

---

## ğŸ¯ æ®µéšçš„ã‚³ã‚¹ãƒˆå‰Šæ¸›æˆ¦ç•¥

### ã€Phase 1ã€‘STGç’°å¢ƒã®æœ€é©åŒ– (å³åº§ã«å®Ÿè¡Œå¯èƒ½)
**å‰Šæ¸›ç›®æ¨™: -$126/æœˆ (25%å‰Šæ¸›)**

#### 1.1 STG VPC Endpointsã®å‰Šé™¤ (-$90/æœˆ)
```bash
cd infrastructure/terraform/stg
terraform destroy -target=aws_vpc_endpoint.secretsmanager
terraform destroy -target=aws_vpc_endpoint.ecr_api
terraform destroy -target=aws_vpc_endpoint.ecr_dkr
terraform destroy -target=aws_vpc_endpoint.logs
```

#### 1.2 STG NAT Gatewayã®å‰Šé™¤ (-$22.5/æœˆ)
```bash
# ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆã§ECSå®Ÿè¡Œã«å¤‰æ›´
terraform apply -target=module.vpc
```

#### 1.3 STG ALBçµ±åˆ (-$13.5/æœˆ)
```bash
# 2å°ã®ALBã‚’1å°ã«çµ±åˆ
terraform apply -target=aws_lb.main
```

**Phase 1åˆè¨ˆå‰Šæ¸›: $126/æœˆ**

---

### ã€Phase 2ã€‘æœ¬ç•ªç’°å¢ƒã®é¸æŠçš„æœ€é©åŒ– (æ…é‡ã«å®Ÿè¡Œ)
**å‰Šæ¸›ç›®æ¨™: -$67.5/æœˆ (13%å‰Šæ¸›)**

#### 2.1 æœ¬ç•ªALBçµ±åˆã®æ¤œè¨ (-$27/æœˆ)
- **ãƒªã‚¹ã‚¯**: éšœå®³æ™‚ã®å½±éŸ¿ç¯„å›²æ‹¡å¤§
- **å¯¾ç­–**: Blue-Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå°å…¥
- **æ¨å¥¨**: Route53 ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è¿½åŠ 

#### 2.2 æœ¬ç•ªVPC Endpointsã®éƒ¨åˆ†å‰Šæ¸› (-$40.5/æœˆ)
å‰Šé™¤å¯¾è±¡ã®å„ªå…ˆé †ä½:
1. **CloudWatch Logs Endpoint** (-$22.5/æœˆ) â† ä½ãƒªã‚¹ã‚¯
2. **ECR DKR Endpoint** (-$22.5/æœˆ) â† ä¸­ãƒªã‚¹ã‚¯
3. **Secrets Manager** (ä¿æŒ) â† é«˜ãƒªã‚¹ã‚¯
4. **ECR API** (ä¿æŒ) â† é«˜ãƒªã‚¹ã‚¯

**Phase 2åˆè¨ˆå‰Šæ¸›: $67.5/æœˆ**

---

### ã€Phase 3ã€‘é•·æœŸçš„ãªæ§‹é€ æœ€é©åŒ– (3-6ãƒ¶æœˆè¨ˆç”»)
**å‰Šæ¸›ç›®æ¨™: -$100/æœˆ (20%å‰Šæ¸›)**

#### 3.1 ECS to EKS on Fargate Spot
- Fargate Spotåˆ©ç”¨ã§æœ€å¤§70%å‰Šæ¸›
- äºˆæƒ³å‰Šæ¸›: $45/æœˆ

#### 3.2 Multi-AZ NAT Gatewayæœ€é©åŒ–
- å˜ä¸€NAT Gateway + VPC Endpointçµ„ã¿åˆã‚ã›
- äºˆæƒ³å‰Šæ¸›: $22.5/æœˆ

#### 3.3 RDS Aurora Serverless v2æ¤œè¨
- ä½¿ç”¨é‡ãƒ™ãƒ¼ã‚¹èª²é‡‘
- äºˆæƒ³å‰Šæ¸›: $15-30/æœˆ

---

## ğŸ¯ **æ¨å¥¨å®Ÿè£…é †åº**

### ğŸ’¡ **å³åº§ã«å®Ÿè¡Œ (ä»Šé€±)** 
**STGç’°å¢ƒã®å®Œå…¨æœ€é©åŒ–**
```bash
# 1. STGç’°å¢ƒã®ã‚³ã‚¹ãƒˆæœ€é©åŒ–é©ç”¨
cd infrastructure/terraform/stg
cp cost-optimized-main.tf main.tf
terraform plan
terraform apply
```
**äºˆæƒ³å‰Šæ¸›: $126/æœˆ**

### ğŸ”„ **æ®µéšçš„å®Ÿè¡Œ (æ¥æœˆ)**
**æœ¬ç•ªç’°å¢ƒã®æ…é‡ãªæœ€é©åŒ–**
```bash
# 1. æœ¬ç•ªCloudWatch Logs Endpointã®å‰Šé™¤
cd infrastructure/terraform/prod
terraform destroy -target=aws_vpc_endpoint.logs

# 2. æœ¬ç•ªALBçµ±åˆã®æº–å‚™
# - ç›£è¦–ä½“åˆ¶å¼·åŒ–
# - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †ç¢ºèª
# - Blue-Green ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå°å…¥
```
**äºˆæƒ³å‰Šæ¸›: $40-67/æœˆ**

---

## ğŸ’° **ã‚³ã‚¹ãƒˆå‰Šæ¸›åŠ¹æœã¾ã¨ã‚**

| Phase | å‰Šæ¸›é¡/æœˆ | ç´¯ç©å‰Šæ¸›é¡ | å‰Šæ¸›ç‡ |
|-------|----------|-----------|--------|
| **Phase 1 (STG)** | $126 | $126 | 25% |
| **Phase 2 (PROD)** | $67.5 | $193.5 | 39% |
| **Phase 3 (é•·æœŸ)** | $100 | $293.5 | 59% |

### ğŸ¯ **æœ€çµ‚ç›®æ¨™**
- **ç¾åœ¨**: $497/æœˆ
- **æœ€é©åŒ–å¾Œ**: $203/æœˆ
- **å‰Šæ¸›é¡**: **$294/æœˆ (59%å‰Šæ¸›)**

---

## âš ï¸ **ãƒªã‚¹ã‚¯ç®¡ç†**

### é«˜ãƒªã‚¹ã‚¯å¤‰æ›´ (æ…é‡ã«å®Ÿè¡Œ)
- âœ… æœ¬ç•ªVPC Endpointså‰Šé™¤
- âœ… æœ¬ç•ªALBçµ±åˆ
- âœ… ECSâ†’EKSç§»è¡Œ

### ä½ãƒªã‚¹ã‚¯å¤‰æ›´ (ç©æ¥µçš„ã«å®Ÿè¡Œ)
- âœ… STGç’°å¢ƒå…¨ä½“æœ€é©åŒ–
- âœ… CloudWatch Logs Endpointå‰Šé™¤
- âœ… NAT Gatewayæœ€é©åŒ–

---

## ğŸ” **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°æŒ‡æ¨™**

### ã‚³ã‚¹ãƒˆç›£è¦–
- AWS Cost Explorer ã§ã®æ—¥æ¬¡ç¢ºèª
- äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š: $400/æœˆ
- ç•°å¸¸æ¤œçŸ¥: å‰æœˆæ¯”+20%ã§é€šçŸ¥

### æ€§èƒ½ç›£è¦–
- ALB Response Time < 200ms
- ECS Task CPU < 70%
- RDS Connection < 80%

---

## ğŸ†˜ **ç·Šæ€¥æ™‚å¯¾å¿œ**

### å³åº§ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ãªè¨­å®š
```bash
# å…¨è¨­å®šã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
terraform state push terraform.tfstate.backup
terraform apply
```

### æ®µéšçš„å¾©æ—§æ‰‹é †
1. ALBè¨­å®šå¾©å…ƒ (1-2åˆ†)
2. NAT Gatewayå¾©å…ƒ (3-5åˆ†)
3. VPC Endpointså¾©å…ƒ (5-10åˆ†) 